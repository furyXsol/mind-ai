"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3173],{23173:function(e,t,s){s.r(t),s.d(t,{default:function(){return Staking_StakingDrawer}});var a=s(85893),n=s(67294),l=s(2593),i=s(94398),r=s(17931);let Slider=e=>{let{className:t,label:s,max:n,min:l=0,step:o=1,onChange:d,value:c,is_percentage:m}=e;return(0,a.jsxs)("div",{className:"".concat(t||""),children:[(0,a.jsx)("label",{htmlFor:"default-range",className:"block mb-2 text-sm font-medium text-secondary",children:s}),(0,a.jsxs)("div",{className:"bg-level-two rounded-lg flex space-x-4 items-center",children:[(0,a.jsx)(i.Range,{step:o,min:l,max:n,values:[Number(c)],onChange:e=>d(e[0]),renderTrack:e=>{let{props:t,children:s}=e;return(0,a.jsx)("div",{...t,style:{...t.style,height:"0.5rem",width:"100%",backgroundColor:r.hr,borderRadius:r.GN},children:s})},renderThumb:e=>{let{props:t}=e;return(0,a.jsx)("div",{...t,style:{...t.style,height:"1rem",width:"1rem",borderRadius:r.GN,backgroundColor:r.lS}})}}),m&&(0,a.jsxs)("div",{className:"w-12",id:"slider",children:[c,"%"]})]})]})};var o=s(61267),d=s(30765),c=s(68851),m=s(10721),u=s(59850),x=s(91328),h=s(41421),p=s(17106);let v=function(e){e=null==e?void 0:e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,s,a){return t+t+s+s+a+a});let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(r.hr),DrawerContainer=e=>{let{children:t}=e,[s,l]=(0,n.useState)(!1),i=(0,m.TL)(),{staking_modal_open:r}=(0,m.CG)(e=>e.staking);return(0,a.jsx)(p.u,{"data-testid":"transition",show:r,enter:"transition-opacity duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"min-w-screen fixed left-0 top-0 flex justify-center items-center inset-0 z-50 outline-none focus:outline-none text-white overflow-auto",style:{backgroundColor:"rgb(".concat(v.r,", ").concat(v.g,", ").concat(v.b,", 0.8)")},onMouseDown:()=>{s||(i((0,c.q5)(!1)),setTimeout(()=>i((0,c.hr)("Deposit")),300))},children:(0,a.jsx)(p.u.Child,{"data-testid":"transition-child",className:"relative text-primary w-full max-w-screen sm:max-w-sm relative ml-auto my-auto shadow-lg bg-dcb min-h-screen border-l-2 border-custom bg-level-one",enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),id:"staking-modal",children:t})})};var g=s(75605),j=s(42812),f=s(51260),b=s(22920),y=s(5866),N=s(62374);let Bounty=()=>{let[e,t]=(0,n.useState)(!1),{account:s}=(0,j.l)(),{current_pool:l,pools:i}=(0,m.CG)(e=>e.staking),r=(0,m.TL)(),[{connectedChain:o},d]=(0,f.Um)(),[x,p]=(0,n.useState)(!1),{contract_idx:v,vault:w,id:k,chain_id:C}=i.find(e=>{let{id:t}=e;return t===l}),[_]=(0,m.C)(w,u.R.Vault,!0),handleClaim=async()=>{let e=await _.estimateGas.harvest(v,{gasLimit:"6500000"});t(!0);try{await (0,h.n2)(_.harvest(v,{gasLimit:e.mul(12).div(10)}),"Successfully claimed bounty from pool",async()=>{r((0,c.nh)(k,s))}),t(!1)}catch(e){b.Am.error(e.reason||e.message),t(!1)}},S=C!==parseInt(null==o?void 0:o.id),setCorrectChainId=()=>{C!==parseInt(null==o?void 0:o.id)?(p(!0),d({chainId:"0x"+C.toString(16)})):p(!1)};return(0,a.jsx)(a.Fragment,{children:S?(0,a.jsx)(N.v,{message:"You can't stake in this pool.",sub_message:"Please connect to the right chain to continue",handleClick:()=>setCorrectChainId(),button_text:"Switch to ".concat(y.g[C].network_name),loading:x}):(0,a.jsx)(g.zx,{className:"w-full",disabled:e,onClick:handleClaim,loading:e,id:"claim-bounty-btn",children:(0,a.jsx)("strong",{children:"Claim bounty"})})})};var w=s(27484),k=s.n(w),C=s(35553),_=s(59860),S=s(85063);let useStakingMethods=()=>{let[e,t]=(0,n.useState)(!1),{account:s}=(0,j.l)(),{current_pool:a,pools:i,deposit_amount:r,second_deposit_amount:d,selected_ids:p,withdraw_percent:v}=(0,m.CG)(e=>e.staking),g=i.find(e=>{let{id:t}=e;return t===a}),{address:f,type:y}=g,N=y===x.W.Compound,[w]=(0,_.C)(f,o.XH[g.type],!0),[k]=(0,_.C)(g.vault,u.R.Vault,!0),C=N?k:w,T=(0,m.TL)(),handleDeposit=async()=>{t(!0);let[e,a]=(0,S.Fg)(g,r,d,p),n=a.slice(0,a.length-1),i=a[a.length-1];try{let t=l.O$.from(65e4);await (0,h.n2)(C[e](...n,{...i,gasLimit:t}),"Transaction successfully complete"),T((0,c.nh)(null==g?void 0:g.id,s)),T((0,c.e4)("0")),T((0,c.Ge)("0"))}catch(e){b.Am.error(e.reason||e.message)}t(!1)},handleWithdraw=async()=>{t(!0);let[e,a]=(0,S.eR)(g,p,Number(v));try{let t=l.O$.from(65e4);await (0,h.n2)(C[e](...a,{gasLimit:t}),"Transaction successfully complete"),T((0,c.nh)(null==g?void 0:g.id,s)),T((0,c.hr)("Deposit"))}catch(e){b.Am.error(e.reason||e.message)}t(!1)};return{handleDeposit,handleWithdraw,loading:e}},LiquidityDeposit=()=>{let{account:e}=(0,j.l)(),{current_pool:t,pools:s,deposit_amount:n="0",second_deposit_amount:i="0"}=(0,m.CG)(e=>e.staking),{input_token:r,second_input_token:d,type:c,end_date:u,is_native:[x,p],address:v,chain_id:b}=s.find(e=>{let{id:s}=e;return s===t}),[y,N]=(0,m.C)(v,o.XH[c],!0),w=0===Number(n),_=(0,C.vz)((0,h.T7)(n||"0"),r.decimals),S=(0,C.vz)((0,h.T7)(i||"0"),d.decimals),{handleDeposit:T,loading:D}=useStakingMethods(),[{connectedChain:F}]=(0,f.Um)(),{approved:W,handleApprove:I,loading:z}=(0,m.A$)(r.address,e,N,_.toString()),{approved:L,handleApprove:M,loading:G}=(0,m.A$)(d.address,e,N,_.toString()),A=(0,m.mM)(r.address,b,x&&0===p),q=(0,m.mM)(d.address,b,x&&1===p),Y=k()().isAfter(k()(u||new Date)),$=l.O$.from(_).gt(A)||l.O$.from(S).gt(q),B=b!==parseInt(null==F?void 0:F.id),H=[[W,r,z,I],[L,d,G,M]].filter((e,t)=>!x||x&&p!==t);return(0,a.jsx)("div",{className:"flex space-x-2",children:H.filter(e=>{let[t]=e;return t}).length===H.length?(0,a.jsx)(g.zx,{className:"flex-1",disabled:D||Y||w||$||B,onClick:T,loading:D,id:"current-version",children:"Deposit"}):H.map((e,t)=>{let[s,n,l,i]=e;return(0,a.jsxs)(g.zx,{className:"flex-1",loading:l,disabled:l||s||B,onClick:i,children:[H.length>1&&"".concat(t+1,". "),"Enable ",n.symbol]},"".concat(n.symbol,"-").concat(t))})})},NFTDeposit=()=>{let{account:e}=(0,j.l)(),{current_pool:t,pools:s,selected_ids:n}=(0,m.CG)(e=>e.staking),l=s.find(e=>{let{id:s}=e;return s===t}),{input_token:i,end_date:r,address:o}=l,{address:d}=i,{handleDeposit:c,loading:u}=useStakingMethods(),{approved:x,handleApprove:h,loading:p}=(0,m.bv)(d,e,o),v=k()().isAfter(k()(r||new Date));return(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(g.zx,{className:"flex-1",loading:p,disabled:p||v||x,onClick:h,id:"enable-btn",children:"1. Enable"}),(0,a.jsx)(g.zx,{className:"flex-1",disabled:u||v||!x||0===n.length,onClick:c,loading:u,id:"deposit-btn",children:"2. Deposit"})]})},StandardDeposit=()=>{let{account:e}=(0,j.l)(),{current_pool:t,pools:s,deposit_amount:n}=(0,m.CG)(e=>e.staking),i=s.find(e=>{let{id:s}=e;return s===t}),{input_token:r,type:o,end_date:d,address:c}=i,u=(0,m.mM)(r.address,i.chain_id),{decimals:p,address:v}=r,f=0===Number((0,h.T7)(n||"0")),b=(0,C.vz)((0,h.T7)(n||"0"),p),{handleDeposit:y,loading:N}=useStakingMethods(),{approved:w,handleApprove:_,loading:S}=(0,m.A$)(v,e,o===x.W.Compound?i.vault:c,b.toString()),T=k()().isAfter(k()(d||new Date)),D=l.O$.from(b),F=D.gt(u),W=T||f||F;return(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(g.zx,{className:"flex-1",loading:S,disabled:S||W||w,onClick:_,id:"enable-btn",children:"1. Enable"}),(0,a.jsx)(g.zx,{className:"flex-1",disabled:N||W||!w,onClick:y,loading:N,id:"deposit-btn",children:"2. Deposit"})]})},Deposit=()=>{let{current_pool:e,pools:t}=(0,m.CG)(e=>e.staking),{type:s,has_stake:l,chain_id:i,end_date:r}=t.find(t=>{let{id:s}=t;return s===e}),o=k()().isAfter(k()(r||new Date)),[d,c]=(0,n.useState)(!!l),[u,h]=(0,n.useState)(!1),[{connectedChain:p},v]=(0,f.Um)(),setCorrectChainId=()=>{i!==parseInt(null==p?void 0:p.id)&&(h(!0),v({chainId:"0x"+i.toString(16)}),h(!1))},j=i!==parseInt(null==p?void 0:p.id);return(0,a.jsx)(a.Fragment,{children:j?(0,a.jsx)(N.v,{message:"You can't stake in this pool.",sub_message:"Please connect to the right chain to continue",handleClick:()=>setCorrectChainId(),button_text:"Switch to ".concat(y.g[i].network_name),loading:u}):o?(0,a.jsxs)("div",{children:["This pool has expired. ",(0,a.jsx)("br",{})," ",(0,a.jsx)(g.ZT,{size:"md",variant:"secondary",className:"mt-2",children:"You cannot deposit additional tokens."})]}):d&&!j?(0,a.jsx)(N.v,{message:"You are already staking in this pool.",sub_message:"Staking more in this pool will increase your rewards but will also extend the lock end date.",handleClick:()=>c(!1),button_text:"Continue"}):(0,a.jsx)(a.Fragment,{children:(e=>{switch(e){case x.W.NFT:return(0,a.jsx)(NFTDeposit,{});case x.W.Liquidity:return(0,a.jsx)(LiquidityDeposit,{});default:return(0,a.jsx)(StandardDeposit,{})}})(s)})})},T={[x.W.Dynamic]:"claim",[x.W.Liquidity]:"claim",[x.W.NFT]:"claimAndRestake"},Withdraw=()=>{let[e,t]=(0,n.useState)(!1),[{connectedChain:s},i]=(0,f.Um)(),[r,d]=(0,n.useState)(!1),{account:u}=(0,j.l)(),p=(0,m.TL)(),{current_pool:v,pools:b,selected_ids:w}=(0,m.CG)(e=>e.staking),{id:C,user_stake:_,type:S,can_claim:D,contract_idx:F,last_user_deposit:W,lock_period:I,address:z,is_withdraw_locked:L,chain_id:M}=b.find(e=>{let{id:t}=e;return t===v}),[G]=(0,m.C)(z,o.XH[S],!0),{handleWithdraw:A,loading:q}=useStakingMethods(),handleClaim=async()=>{t(!0),await (0,h.n2)(G[T[S]](F),"Successfully claimed rewards from pool",async()=>{p((0,c.nh)(C,u))}),t(!1)},Y=x.W.Dynamic===S,$=x.W.NFT===S,B=x.W.Liquidity===S,H=$&&0===w.length,O=!$&&l.O$.from(_).eq(0),R=k()().subtract(parseInt(I),"days").isAfter(k()(W)),E=[x.W.NFT,x.W.Liquidity,x.W.Dynamic].includes(S),U=O||H||[x.W.Liquidity].includes(S)&&L&&!R||Y&&!R,V=M!==parseInt(null==s?void 0:s.id),setCorrectChainId=()=>{M!==parseInt(null==s?void 0:s.id)?(d(!0),i({chainId:"0x"+M.toString(16)})):d(!1)};return(0,a.jsx)(a.Fragment,{children:V?(0,a.jsx)(N.v,{message:"You can't stake in this pool.",sub_message:"Please connect to the right chain to continue",handleClick:()=>setCorrectChainId(),button_text:"Switch to ".concat(y.g[M].network_name),loading:r}):(0,a.jsxs)("div",{className:"flex space-x-2",children:[E&&(0,a.jsxs)(g.zx,{className:"flex-1",loading:e,disabled:e||!(D||B&&L||Y),onClick:handleClaim,children:["Claim",$&&" & relock"]}),(0,a.jsx)(g.zx,{className:"flex-1",disabled:q||U,onClick:A,loading:q,id:"withdraw-btn",children:"Withdraw"})]})})},render=e=>{switch(e){case"Bounty":return(0,a.jsx)(Bounty,{});case"Withdraw":return(0,a.jsx)(Withdraw,{});default:return(0,a.jsx)(Deposit,{})}},Footer=()=>{let{connect:e,account:t}=(0,j.l)(),{modal_state:s}=(0,m.CG)(e=>e.staking);return(0,a.jsx)("div",{className:"w-full bg-level-two p-4 absolute bottom-0 border-t border-custom border-opacity-[0.03]",children:t?render(s):(0,a.jsx)(g.zx,{className:"w-full",onClick:()=>e(void 0),children:"Connect wallet"})})};var D=s(93515),F=s(58974),W=s(41664),I=s.n(W);let NoNFTS=e=>{let{url:t="",text:s,className:n=""}=e,{connect:l}=(0,j.l)();return(0,a.jsx)("div",{className:"w-full flex items-center justify-center text-center p-5 ".concat(n),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("img",{src:"/icons/no-nfts.svg",className:"mx-auto my-8",alt:"Staked all NFTs"}),(0,a.jsx)("h3",{className:"text-lg text-primary my-8",children:(0,a.jsx)("strong",{children:s})}),(0,a.jsx)(I(),{href:t,target:"_blank",rel:"noopener,noreferrer",children:(0,a.jsx)(g.zx,{className:"w-full",children:"Get NFTs"})}),(0,a.jsx)("p",{className:"my-8 text-secondary underline cursor-pointer",onClick:()=>l(void 0),children:"Change wallet"})]})})},InputItem=e=>{let{nft:{id:t,data:s},selected_ids:l,max_per_user:i,num_staked:r,available:o}=e,[d,u]=(0,n.useState)(!0),x=(0,n.useMemo)(()=>l.includes(t),[t,l]),h=(0,m.TL)();return(0,a.jsxs)("div",{className:"text-left",id:"NFT selector",children:[(0,a.jsxs)("div",{className:"relative rounded cursor-pointer ".concat(x?"border border-accent":""),onClick:()=>{if(l.includes(t)){h((0,c.oT)(l.filter(e=>e!==t)));return}o&&r+l.length>=i||h((0,c.oT)([...l,t]))},children:[(0,a.jsx)("img",{src:s,alt:t.toString(),className:"rounded w-full bg-main aspect-square ".concat(d?"animate-pulse":""),onLoad:()=>u(!1)}),x&&(0,a.jsx)("div",{className:"absolute top-2 left-2 border border-custom rounded",children:(0,a.jsx)(F.J,{className:"text-accent"})})]}),(0,a.jsxs)("p",{className:"text-secondary",children:["#",t]})]})},NFTSelect=e=>{let{pool:t,available:s=!0}=e,{selected_ids:n}=(0,m.CG)(e=>e.staking),l=t[s?"available_tokens":"staked_tokens"];return l.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-72 overflow-scroll",children:l.map(e=>(0,a.jsx)(InputItem,{nft:e,selected_ids:n,max_per_user:t.max_per_user,num_staked:t.staked_tokens.length,available:s},"nft-input-".concat(e.id)))}):(0,a.jsx)(NoNFTS,{text:"You are staking all of your available NFTs",url:t.collection_url})},NumberInput=e=>{let{pool:t,reserves:s}=e,i=(null==t?void 0:t.chain_id)||r.Kj,o=r.k3[i],{symbol:d,decimals:u}=o||{symbol:"",decimals:18},[p,v]=(0,n.useState)(!1),{loading:j,deposit_amount:f}=(0,m.CG)(e=>e.staking),b=(0,m.TL)(),{input_token:y,is_native:N=[!1,0]}=t,w=(0,m.mM)(y.address,t.chain_id,N[0]&&0===N[1]),{hardcap:k,total_staked:_}=t,{symbol:S=d,decimals:T=u}=(null==t?void 0:t.input_token)||{},setSecondDeposit=e=>{var a;let n=(0,C.vz)(e||"0",y.decimals).mul(s.reserve1).div(s.reserve0.eq(0)?1:s.reserve0);b((0,c.Ge)((0,C.bM)(n,(null===(a=t.second_input_token)||void 0===a?void 0:a.decimals)||18)))},D=t.type===x.W.Liquidity,F=(0,C.vz)(f||"0",y.decimals),W=F.gt(w);return(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(g.II,{loading:j,err_border:W,value:f,onChange:e=>{let t=e.target.value;(0,h.K3)(t,y.decimals)?(b((0,c.e4)(t.toString())),D&&setSecondDeposit(t.toString())):console.error("Deposit amount exceeds allowed decimals")},surface:"zero",handleMaxClick:()=>{let e=l.O$.from(k).sub(_),t=D?w:l.O$.from(w).gt(e)?e:w,s=(0,C.vz)((0,h.T7)((0,h.am)(t,y.decimals)),y.decimals).toString(),a=(0,h.Ff)(s,t.toString(),y.decimals);a=0>Number(a)?"0":a,b((0,c.e4)(a)),D&&setSecondDeposit(a)},unit:S,type:"number",is_initialized:p,onFocus:()=>v(!0)})}),(0,a.jsxs)("div",{className:"flex items-center mt-4 text-sm",children:[(0,a.jsx)("div",{className:"flex-1 text-sm text-secondary",children:"Available to stake"}),(0,a.jsx)("strong",{className:"".concat(W?"text-primary":""),children:"".concat((0,h.am)(w,T)," ").concat(S)})]})]})},SecondNumberInput=e=>{let{pool:t,reserves:s}=e,{symbol:l,decimals:i}=r.k3[t.chain_id],{loading:o,second_deposit_amount:d}=(0,m.CG)(e=>e.staking),[u,x]=(0,n.useState)(!1),p=(0,m.TL)(),v=(0,m.mM)(t.second_input_token.address,t.chain_id,t.is_native[0]&&1===t.is_native[1]),{symbol:j=l,decimals:f=i}=(null==t?void 0:t.second_input_token)||{},setFirstDepositAmount=e=>{let a=s.reserve1.eq(0),n=(0,C.vz)(e||"0",f).mul(s.reserve0).div(a?1:s.reserve1);p((0,c.e4)((0,C.bM)(n,t.input_token.decimals)))},b=(0,C.vz)((0,h.T7)(d||"0"),f),y=b.gt(v);return(0,a.jsxs)("div",{className:"text-left mt-4",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(g.II,{surface:"zero",loading:o,err_border:y,value:d,onChange:e=>{let t=e.target.value;p((0,c.Ge)(t.toString())),setFirstDepositAmount(t.toString())},handleMaxClick:()=>{let e=(0,C.vz)((0,h.T7)((0,h.am)(v,f)),f).toString(),t=(0,h.Ff)(e,v);p((0,c.Ge)(t)),setFirstDepositAmount(t)},unit:j,type:"number",onFocus:()=>x(!0),is_initialized:u})}),(0,a.jsxs)("div",{className:"flex items-center mt-4 text-sm",children:[(0,a.jsx)("div",{className:"flex-1 text-sm text-secondary",children:"Available to stake"}),(0,a.jsx)("strong",{className:"".concat(y?"text-primary":""),children:"".concat((0,h.am)(v,f)," ").concat(j)})]})]})},Input=e=>{let{pool:t}=e;if(t.type===x.W.NFT)return(0,a.jsx)(NFTSelect,{pool:t});let s=(0,D.m)(t.pair,t.chain_id);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(NumberInput,{pool:t,reserves:s}),t.type===x.W.Liquidity&&(0,a.jsx)(SecondNumberInput,{pool:t,reserves:s})]})};var z=s(73628),L=s(32790),StakingDrawer_ModalHeader=()=>{let e=(0,m.TL)(),{current_pool:t,pools:s}=(0,m.CG)(e=>e.staking),n=s.find(e=>{let{id:s}=e;return s===t}),l=n.type===x.W.NFT;return(0,a.jsxs)("div",{className:"h-40 relative overflow-hidden ".concat(l?"":"bg-staking-header"),children:[(0,a.jsx)("button",{"data-testid":"modal-header-btn",className:"absolute top-4 left-4 z-50",onClick:()=>{e((0,c.hr)("Deposit")),e((0,c.q5)(!1))},children:(0,a.jsx)(z.X1,{})}),(0,a.jsx)("img",{src:y.g[n.chain_id].network_logo,width:32,height:32,className:"absolute right-4 top-4"}),!l&&(0,a.jsx)(L.J,{pool:n,className:"absolute left-4 bottom-4"}),l&&(0,a.jsx)("h3",{className:"absolute left-4 bottom-4 text-2xl z-50",children:(0,a.jsx)("strong",{children:n.name})}),l&&(0,a.jsx)("img",{alt:n.name,src:n.header_logo,className:"w-full absolute"})]})},M=s(62378),G=s(59927),A=s(88326);let TextItem=e=>{let{text:t,title:s,info:n,checked:l}=e;return(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1 text-secondary",children:n?(0,a.jsx)(M.XU,{info:n,text:s}):s}),(0,a.jsx)("div",{className:"flex items-center space-x-2 ".concat(l?"text-success":""),children:(0,a.jsx)("strong",{children:t})})]})};var StakingDrawer_SummaryText=e=>{let{deposit_amount:t,withdraw_amount:s}=e,{current_pool:n,pools:i,modal_state:r,withdraw_percent:o}=(0,m.CG)(e=>e.staking),d=i.find(e=>{let{id:t}=e;return t===n}),{id:c,user_stake:u="0",earned_reward:p="0",has_stake:v,reward_rate:g="0",input_token:j,reward_token:f,type:b,is_withdraw_locked:y,last_user_deposit:N,lock_period:w}=d||{},_=l.O$.from((0,C.vz)((0,h.T7)(t||"0"),(null==j?void 0:j.decimals)||18)).add(u),T=b===x.W.Compound?(100*(0,A.WZ)(parseFloat(g)/100,365)).toFixed(2)+"%":g,D=b===x.W.Compound,F=b===x.W.NFT,W=b===x.W.Liquidity,I=b===x.W.Dynamic,z=k()().isAfter(k()(N).add(parseInt(w),"days")),L=W?o:100,{boost:q,has_boost:Y}=(0,S.xS)(d);return(0,a.jsxs)(a.Fragment,{children:["Deposit"===r&&(0,a.jsxs)("div",{className:"my-8",children:[v&&F&&(0,a.jsx)(TextItem,{title:"Your stake",text:"".concat(u," / ").concat(d.max_per_user)}),(0,a.jsx)(TextItem,{title:"Lock period",text:w+" days"}),(0,a.jsx)(TextItem,{title:F?"Daily reward per NFT":"Reward",text:F?"".concat((0,h.am)(g)," ").concat(d.reward_token.symbol):T,info:I?"Annual percentage yield (APY). The percent will change depending on a total amount staked, but rewards can be claimed any time.":void 0}),!F&&(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1 text-secondary",children:(0,a.jsxs)("div",{className:"flex items-center flex-wrap space-x-2",children:[(0,a.jsx)("p",{children:"NFT boost"}),(0,a.jsx)(G.P,{id:c,children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),(0,a.jsx)("div",{className:"flex items-center space-x-2 ".concat(Y?"text-success":""),children:(0,a.jsxs)("strong",{children:["+",Y?q:0,"%"]})})]}),v&&!F&&(0,a.jsx)(TextItem,{title:"Stake after deposit",text:"".concat((0,h.am)(_.add(D?p:0),null==j?void 0:j.decimals)," ").concat(null==j?void 0:j.symbol)}),""!==N&&(0,a.jsx)(TextItem,{title:"Current lock end date",text:N?k()(N).add(parseInt(w),"days").format("HH:mm MMM DD, YYYY"):"None",info:"You can withdraw the deposited amount and rewards after the current lock date has expired."}),""!==w&&(0,a.jsx)(TextItem,{title:(v?"New l":"L")+"ock end date",text:k()().add(Number(w),"days").format("HH:mm MMM DD, YYYY"),info:"The lock period will be reset when you deposit additional tokens to this pool. This will become the new lock period."})]}),"Withdraw"===r&&(0,a.jsxs)("div",{className:"my-4",children:[!F&&(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("p",{className:"text-secondary",children:"Withdraw amount"})}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:[(0,h.am)(s.mul(L).div(100),null==j?void 0:j.decimals)," ",null==j?void 0:j.symbol]})}),W&&(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:[(0,h.am)(l.O$.from(d.second_user_stake).mul(L).div(100),null==d?void 0:d.second_input_token.decimals)," ",null==d?void 0:d.second_input_token.symbol]})})]})]}),(0,a.jsxs)("div",{className:"flex my-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("p",{className:"text-secondary",children:"Earned reward"})}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{children:(0,a.jsxs)("strong",{children:[(0,h.am)(l.O$.from(p).mul(L).div(100),null==f?void 0:f.decimals)," ",null==f?void 0:f.symbol]})})})]}),!y&&!z&&(0,a.jsx)(M.v3,{children:"Withdrawing before the lock end date will yield no rewards."})]})]})},q=s(22425),StakingDrawer_Switch=e=>{let{bounty:t}=e,s=(0,m.TL)(),{current_pool:n,pools:l,modal_state:i}=(0,m.CG)(e=>e.staking),r=l.find(e=>{let{id:t}=e;return t===n}),o=r.has_stake&&(r.can_claim||[x.W.Liquidity,x.W.Dynamic].includes(r.type)||!r.is_withdraw_locked);return(0,a.jsxs)("div",{className:"bg-level-one flex rounded cursor-pointer text-sm ".concat("Deposit"===i&&"mb-4"||""),children:[(0,a.jsx)("div",{"data-testid":"deposit-div",onClick:()=>s((0,c.hr)("Deposit")),className:"flex-1 px-4 py-2 rounded border-2 border-level-one ".concat("Deposit"===i?"bg-level-two":"text-secondary bg-level-one"),children:"Deposit"===i?(0,a.jsx)("strong",{children:"Deposit"}):"Deposit"}),r.type===x.W.Compound&&t.gt(0)&&(0,a.jsx)("div",{"data-testid":"bounty-div",onClick:()=>s((0,c.hr)("Bounty")),className:"flex-1 px-4 py-2 rounded border-2 border-level-one ".concat("Bounty"===i?"bg-level-two":"text-secondary bg-level-one"),children:"Bounty"===i?(0,a.jsx)("strong",{children:"Bounty"}):"Bounty"}),(0,a.jsx)("div",{"data-testid":"withdraw-div",onClick:()=>o&&s((0,c.hr)("Withdraw")),className:"flex-1 px-4 py-2 rounded border-2 border-level-one ".concat("Withdraw"===i?"bg-level-two":"text-secondary bg-level-one"),children:(0,a.jsx)(q.u,{text:"You can withdraw the deposited amount and rewards after the lock date has expired.",active:!o,children:(0,a.jsxs)("div",{className:"flex items-center",children:[!o&&(0,a.jsx)("svg",{"data-testid":"svg",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 pr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),(0,a.jsx)("div",{className:"flex-1",children:"Withdraw"===i?(0,a.jsx)("strong",{children:"Withdraw"}):"Withdraw"})]})})})]})};let isNFTAndNoNFTs=e=>{let{type:t,available_tokens:s,staked_tokens:a}=e;return t===x.W.NFT&&0===s.length&&0===a.length},StakingDrawer_Bounty=e=>{let{bounty:t,price:s,chain_id:n}=e,l=t.mul(s).div(BigInt(10**r.k3[n].decimals).toString());return(0,a.jsxs)("div",{className:"pt-4 px-2",children:[(0,a.jsxs)("div",{className:"px-4 py-6 text-center bg-level-three rounded border border-custom",children:[(0,a.jsxs)("h3",{className:"text-primary text-2xl","data-testid":"bounty-value",children:[(0,h.am)(t,r.k3[n].decimals,6)," ",r.k3[n].symbol]}),(0,a.jsxs)("p",{className:"text-secondary",children:["~ ",(0,h.am)(l,18,6)," USD"]})]}),(0,a.jsx)("p",{className:"text-left text-sm text-secondary mt-4",children:"Claim bounty straight to your wallet and compound staking rewards for everyone in this pool."})]})};var Staking_StakingDrawer=()=>{let[e,t]=(0,n.useState)(l.O$.from(0)),[s,i]=(0,n.useState)(!0),h=(0,m.CG)(e=>{var t;return null==e?void 0:null===(t=e.staking)||void 0===t?void 0:t.deposit_amount})||"0",{current_pool:p,pools:v,modal_state:g,withdraw_percent:j}=(0,m.CG)(e=>e.staking),f=(0,m.TL)(),b=v.find(e=>{let{id:t}=e;return t===p}),{vault:y,contract_idx:N,chain_id:w}=v.find(e=>{let{id:t}=e;return t===p})||{},k=(0,m.pQ)(null!=w?w:r.Kj),C=(0,d.ti)(y,u.R.Vault,w),_=l.O$.from((null==b?void 0:b.user_stake)||0),S=(null==b?void 0:b.type)===x.W.Liquidity,T=(null==b?void 0:b.type)===x.W.NFT,D=(0,n.useMemo)(()=>isNFTAndNoNFTs(b||{}),[b]),onSliderChange=e=>{f((0,c.tV)(e))};return(0,n.useEffect)(()=>{if(o.qx||!C)return;s&&C&&(i(!1),C.calculateHarvestDcbRewards(N).then(e=>t(e)));let e=setInterval(()=>C.calculateHarvestDcbRewards(N).then(e=>t(e)),5e3);return()=>{clearInterval(e)}},[C,N]),(0,a.jsx)(DrawerContainer,{children:(0,a.jsxs)("div",{className:"pb-12",children:[(0,a.jsx)(StakingDrawer_ModalHeader,{}),D?(0,a.jsx)(NoNFTS,{text:"Looks like you donâ€™t have any compatible NFTs to stake in this pool",className:"h-[32rem] p-10",url:b.collection_url}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"bg-level-two p-4 text-center rounded",children:[(0,a.jsx)(StakingDrawer_Switch,{bounty:e}),"Deposit"===g&&(0,a.jsx)(Input,{pool:b})||"Withdraw"===g&&T&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(NFTSelect,{pool:b,available:!1})}),"Withdraw"===g&&S&&(0,a.jsx)(Slider,{className:"mt-4",onChange:e=>onSliderChange(e),max:100,min:5,step:5,value:j.toString(),is_percentage:!0}),"Bounty"===g&&(0,a.jsx)(StakingDrawer_Bounty,{bounty:e,price:k,chain_id:w})]}),(0,a.jsx)(StakingDrawer_SummaryText,{deposit_amount:h,withdraw_amount:_})]}),(0,a.jsx)(Footer,{})]})]})})}}}]);